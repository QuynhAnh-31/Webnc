<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Danh Sách Phiếu Mượn</title>
    <style>
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .error { color: red; }
        .text-green { color: green; }
    </style>
</head>
<body>
    <h1>Quản Lý Phiếu Mượn</h1>
    <form th:action="@{/borrows}" method="get">
        <input type="text" name="search" placeholder="Tìm kiếm theo tên người dùng hoặc tiêu đề sách" />
        <button type="submit">Tìm</button>
    </form>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Người Mượn</th>
                <th>Sách</th>
                <th>Ngày Mượn</th>
                <th>Ngày Phải Trả</th>
                <th>Ngày Trả</th>
                <th>Trạng Thái</th>
                <th>Hành Động</th>
            </tr>
        </thead>
        <tbody>
            <tr th:if="${#lists.isEmpty(borrowRecords)}">
                <td colspan="8" style="text-align:center;">Không có phiếu mượn nào</td>
            </tr>
            <tr th:each="record : ${borrowRecords}">
                <td th:text="${record.id}"></td>
                <td th:text="${record.user.name}"></td>
                <td th:text="${record.book.title}"></td>
                <td th:text="${#dates.format(record.borrowDate, 'dd/MM/yyyy')}"></td>
                <td th:text="${#dates.format(record.dueDate, 'dd/MM/yyyy')}"></td>
                <td th:text="${record.returnDate != null ? #dates.format(record.returnDate, 'dd/MM/yyyy') : 'Chưa trả'}"></td>
                <td>
                    <span th:text="${record.status}"
                          th:classappend="${record.status == 'overdue'} ? 'error' : (record.status == 'returned' ? 'text-green' : '')"></span>
                </td>
                <td>
                    <a th:href="@{/borrows/edit/{id}(id=${record.id})}">Sửa</a>
                    <a th:href="@{/borrows/delete/{id}(id=${record.id})}" onclick="return confirm('Xóa phiếu mượn này?')">Xóa</a>
                </td>
            </tr>
        </tbody>
    </table>
    <a th:href="@{/borrows/add}">Thêm Phiếu Mượn</a>
</body>
</html>